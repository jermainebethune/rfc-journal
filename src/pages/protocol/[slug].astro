---
import Layout from '../../layouts/Layout.astro';
import data from '../../data/rfcs.json';

export function getStaticPaths() {
  return data.protocols.map((protocol) => ({
    params: { slug: protocol.slug },
    props: { protocol },
  }));
}

const { protocol } = Astro.props;
const years = protocol.rfcs.map(r => r.year);
const minYear = Math.min(...years);
const maxYear = Math.max(...years);

function getStatusClass(status: string) {
  if (status.includes('Standard')) return 'badge-standard';
  if (status.includes('Proposed')) return 'badge-proposed';
  if (status.includes('Experimental')) return 'badge-experimental';
  return 'badge-informational';
}
---

<Layout title={`${protocol.name} — The RFC Journal`}>
  <div class="container">
    
    <!-- Breadcrumb -->
    <nav class="font-ui" style="font-size: 0.75rem; padding: 0.75rem 0; border-bottom: 1px solid var(--color-gray-300); margin-bottom: 2rem;">
      <a href="/" style="color: var(--color-wsj-blue);">Home</a>
      <span style="margin: 0 0.5rem; color: var(--color-gray-400);">/</span>
      <span style="font-weight: 600;">{protocol.name}</span>
    </nav>
    
    <!-- Header -->
    <header style="padding-bottom: 2rem; border-bottom: 2px solid var(--color-black); margin-bottom: 2rem;">
      <p class="section-label">{protocol.fullName}</p>
      <h1 class="font-headline" style="font-size: 3rem; margin-bottom: 0.75rem;">{protocol.name}</h1>
      <p class="font-body" style="font-size: 1.125rem; line-height: 1.8; color: var(--color-gray-700); max-width: 48rem;">
        {protocol.description}
      </p>
      <div class="font-ui" style="display: flex; gap: 2rem; margin-top: 1rem; font-size: 0.875rem; color: var(--color-gray-600);">
        <span><strong>{protocol.rfcs.length}</strong> documents</span>
        <span><strong>{minYear}–{maxYear}</strong></span>
      </div>
    </header>
    
    <!-- RFC Table -->
    <section>
      <h3 class="font-ui" style="font-size: 0.6875rem; font-weight: 700; letter-spacing: 0.15em; text-transform: uppercase; padding-bottom: 0.75rem; border-bottom: 1px solid var(--color-gray-300); margin-bottom: 0;">
        Complete RFC Index
      </h3>
      
      <table>
        <thead>
          <tr>
            <th style="width: 100px;">RFC</th>
            <th>Title</th>
            <th style="width: 80px;">Year</th>
            <th style="width: 160px;">Status</th>
          </tr>
        </thead>
        <tbody>
          {protocol.rfcs.map((rfc) => (
            <tr>
              <td>
                <a href={`/protocol/${protocol.slug}/rfc/${rfc.number}`} class="font-mono" style="font-weight: 600;">
                  RFC {rfc.number}
                </a>
              </td>
              <td>
                <a href={`/protocol/${protocol.slug}/rfc/${rfc.number}`} style="color: var(--color-black);">
                  {rfc.title}
                </a>
              </td>
              <td class="text-gray-600">{rfc.year}</td>
              <td>
                <span class={`badge ${getStatusClass(rfc.status)}`}>{rfc.status}</span>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </section>
    
    <!-- Back Link -->
    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--color-gray-300);">
      <a href="/" class="font-ui" style="font-size: 0.875rem; font-weight: 600; color: var(--color-wsj-blue);">
        ← Back to Protocol Index
      </a>
    </div>
    
  </div>
</Layout>
